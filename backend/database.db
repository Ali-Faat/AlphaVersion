CREATE TABLE usuarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(255),
    email VARCHAR(255) UNIQUE,
    senha VARCHAR(255),
    tipo_usuario VARCHAR(255),
    foto_perfil VARCHAR(255),
    data_criacao DATETIME,
    ultimo_login DATETIME
);

CREATE TABLE quadras (
    id_sequencial INT PRIMARY KEY AUTO_INCREMENT, 
    id VARCHAR(255) UNIQUE NOT NULL,
    nome VARCHAR(255),
    endereco VARCHAR(255),
    tipo VARCHAR(255),
    imagens JSON,
    descricao TEXT,
    preco_hora DECIMAL(10, 2),
    disponibilidade JSON,
    avaliacao_media DECIMAL(3, 2)
);


DELIMITER //
CREATE TRIGGER before_insert_quadra
BEFORE INSERT ON quadras
FOR EACH ROW
BEGIN
    SET NEW.id = CONCAT('Q', LPAD(NEW.id_sequencial, 5, '0'));
END//
DELIMITER ;

CREATE TABLE partidas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    organizador_id INT,
    quadra_id VARCHAR(45),
    data_hora DATETIME,
    tipo_jogo VARCHAR(255),
    nivel_habilidade VARCHAR(255),
    numero_jogadores INT,
    valor_partida DECIMAL(10, 2),
    status VARCHAR(255),
    FOREIGN KEY (organizador_id) REFERENCES usuarios(id),
    FOREIGN KEY (quadra_id) REFERENCES quadras(id)
);

CREATE TABLE partidas_jogadores (
    partida_id INT,
    jogador_id INT,
    confirmacao VARCHAR(255),
    pagamento VARCHAR(255),
    PRIMARY KEY (partida_id, jogador_id),
    FOREIGN KEY (partida_id) REFERENCES partidas(id),
    FOREIGN KEY (jogador_id) REFERENCES usuarios(id)
);

CREATE TABLE arbitros_partidas (
    arbitro_id INT,
    partida_id INT,
    PRIMARY KEY (arbitro_id, partida_id),
    FOREIGN KEY (arbitro_id) REFERENCES usuarios(id),
    FOREIGN KEY (partida_id) REFERENCES partidas(id)
);

CREATE TABLE videos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT,
    url VARCHAR(255),
    tipo VARCHAR(255),
    data_criacao DATETIME,
    FOREIGN KEY (partida_id) REFERENCES partidas(id)
);

CREATE TABLE avaliacoes_quadras (
    id INT PRIMARY KEY AUTO_INCREMENT,
    quadra_id VARCHAR(45),
    jogador_id INT,
    nota INT,
    comentario TEXT,
    FOREIGN KEY (quadra_id) REFERENCES quadras(id),
    FOREIGN KEY (jogador_id) REFERENCES usuarios(id)
);
